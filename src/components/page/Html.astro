---
import { icons } from '~/assets/images/images.icons';
import Header from './Header.astro';
import ThemeToggle from '~/components/base/ThemeToggle.astro';
import '@fontsource/space-grotesk/400.css';
import '@fontsource/space-grotesk/500.css';
import '@fontsource/space-grotesk/700.css';

type Props = {
  title: string;
  description: string
  jsonLd?: unknown;
  image?: string;
  themeColor?: string;
  hideHeader?: boolean;
  type?: 'website' | 'article';
  publishedTime?: Date;
  modifiedTime?: Date;
  author?: string;
  tags?: string[];
}

const { title, description, jsonLd, themeColor, image, hideHeader, type = 'website', publishedTime, modifiedTime, author, tags }= Astro.props;
const schema = JSON.stringify(jsonLd);
const canonicalUrl = Astro.site ? new URL(Astro.url.pathname, Astro.site).href : Astro.url.pathname;
const imageUrl = image && Astro.site ? new URL(image, Astro.site).href : image;
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    <meta name='HandheldFriendly' content='True' />
		<meta name="viewport" content="width=device-width" />
    <script is:inline>
      (function() {
        const stored = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = stored || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
		<meta name="generator" content={Astro.generator} />
    <link rel='sitemap' href='/sitemap-index.xml' />
    <link rel='manifest' href='/manifest.webmanifest' />
    <script is:inline defer src="https://umami.olsen.cloud/script.js" data-website-id="3284fd7a-6452-4048-8c8c-19740171b793" />
    {themeColor && <meta name='theme-color' content={themeColor} />}
    <link
      rel='alternate'
      type='application/rss+xml'
      title='RSS Feed'
      href='/articles/rss.xml'
    />
    <!-- Primary Meta Tags -->
    <meta name='description' content={description} />
    <link rel='canonical' href={canonicalUrl} />

    <!-- Open Graph / Facebook -->
    <meta property='og:type' content={type} />
    <meta property='og:url' content={canonicalUrl} />
    <meta property='og:title' content={title} />
    <meta property='og:description' content={description} />
    {imageUrl && <meta property='og:image' content={imageUrl} />}
    {type === 'article' && publishedTime && (
      <meta property='article:published_time' content={publishedTime.toISOString()} />
    )}
    {type === 'article' && modifiedTime && (
      <meta property='article:modified_time' content={modifiedTime.toISOString()} />
    )}
    {type === 'article' && author && (
      <meta property='article:author' content={author} />
    )}
    {type === 'article' && tags && tags.map(tag => (
      <meta property='article:tag' content={tag} />
    ))}

    <!-- Twitter -->
    <meta name='twitter:card' content={imageUrl ? 'summary_large_image' : 'summary'} />
    <meta name='twitter:url' content={canonicalUrl} />
    <meta name='twitter:title' content={title} />
    <meta name='twitter:description' content={description} />
    {imageUrl && <meta name='twitter:image' content={imageUrl} />}

    <!-- JSON-LD Structured Data -->
    {
      jsonLd && (
        <script type='application/ld+json' is:inline set:html={schema} />
      )
    }
    {
      icons.pngs.map((icon) => (
        <link rel='icon' href={icon.src} type='image/png' sizes={icon.size} />
      ))
    }
    <title>{title}</title>
	</head>
	<body>
    {!hideHeader && <Header />}
		<slot />
    <div class="theme-toggle-fixed">
      <ThemeToggle />
    </div>
	</body>
</html>

<script is:inline>
const withFadeIn = document.querySelectorAll('[data-fadein]');

withFadeIn.forEach((node) => {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        node.classList.remove('hidden');
        node.setAttribute('data-shown', 'true')
      } else if (!node.hasAttribute('data-shown')) {
        node.classList.add('hidden');
      }
    })
  })

  observer.observe(node);
})
</script>

<style is:global>

@view-transition {
    navigation: auto; /* enabled! */
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  text-indent: 0;
  list-style-type: none;
}
html,
body {
  width: 100%;
  height: 100%;
}

:root {
  /* Theme colors - bold neo-brutalist palette */
  --accent-primary: #ffee00;
  --accent-secondary: #ff5757;
  --accent-tertiary: #00d4ff;
  --accent-lime: #c8ff00;
  --accent-lavender: #e4c1f9;

  /* Neo-brutalism core */
  --border-width: 4px;
  --border-color: #000;
  --shadow-offset: 6px;
  --shadow-brutal: var(--shadow-offset) var(--shadow-offset) 0 var(--border-color);
  --shadow-brutal-lg: 8px 8px 0 var(--border-color);

  /* Remove all border-radius */
  --radius: 0;
  --radius-sm: 0;

  /* Page background - off-white with subtle pattern feel */
  --page-bg: #f0f0e8;
  --card-bg: #fff;

  /* Legacy variables */
  --c-bg-em: #e8e8e0;
  --c-line: #000;
  --content-width: 1100px;
  --gap: 16px;
  --system-ui: 'Space Grotesk', system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  --t-fg: #000;
  --bg: #fff;
  --fw-df: 400;
  --fw-md: 700;
  --fs-sm: 14px;
  --fs-md: 16px;

  /* Typography */
  --font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
    Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
  --font-family-heading: 'Space Grotesk', var(--font-family);
  --font-size: 16px;
  --letter-spacing: 0.5px;
  --color: #000;
  --background-color: var(--page-bg);

  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 2rem;
  --space-xl: 3rem;
  --space-xxl: 4rem;

  --font-xxl: 2.5rem;
  --font-xl: 1.75rem;
  --font-lg: 1.25rem;
  --font-sm: 0.875rem;
  --font-xs: 0.75rem;

  --color-text-light: #333;
  --color-border: #000;
  --color-link: #000;

  /* Text/border color for elements with accent backgrounds */
  --on-accent: #000;
}

/* Dark mode overrides */
[data-theme="dark"] {
  --page-bg: #1a1a1f;
  --card-bg: #252530;
  --t-fg: #f0f0e8;
  --color: #f0f0e8;
  --border-color: #f0f0e8;
  --shadow-brutal: var(--shadow-offset) var(--shadow-offset) 0 rgba(240, 240, 232, 0.3);
  --shadow-brutal-lg: 8px 8px 0 rgba(240, 240, 232, 0.3);
  --c-bg-em: #2f2f3a;
  --c-line: #f0f0e8;
  --bg: #252530;
  --background-color: var(--page-bg);
  --color-text-light: #b0b0a8;
  --color-border: #f0f0e8;
  --color-link: #f0f0e8;

  /* Vibrant accents for dark mode - same as light mode */
  --accent-primary: #ffee00;
  --accent-secondary: #ff5757;
  --accent-tertiary: #00d4ff;
  --accent-lime: #c8ff00;
  --accent-lavender: #e4c1f9;

  /* Text/border on accent backgrounds stays dark */
  --on-accent: #000;
}

/* Dark mode: hero grid pattern */
[data-theme="dark"] .hero {
  background-image:
    linear-gradient(rgba(240, 240, 232, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(240, 240, 232, 0.05) 1px, transparent 1px);
}

/* Dark mode: elements with accent backgrounds need dark text */
[data-theme="dark"] .photo-label,
[data-theme="dark"] .hero-headline span,
[data-theme="dark"] .hero-desc,
[data-theme="dark"] .floating-badge,
[data-theme="dark"] .section-title,
[data-theme="dark"] .section-title h2,
[data-theme="dark"] .profiles h2,
[data-theme="dark"] .companyName h3,
[data-theme="dark"] .skill-name h3 {
  color: var(--on-accent);
}

/* Dark mode: link hover states with accent backgrounds */
[data-theme="dark"] p a:hover,
[data-theme="dark"] .content a:hover {
  color: var(--on-accent);
}

/* Dark mode: button/CTA hover states */
[data-theme="dark"] .hero-cta:hover,
[data-theme="dark"] .scroll-btn:hover,
[data-theme="dark"] .profile a:hover {
  color: var(--on-accent);
}

html {
  background-color: var(--page-bg);
  scroll-behavior: smooth;
  overflow-x: hidden;
}

body {
  font-family: var(--system-ui);
  font-size: var(--fs-md);
  font-weight: var(--fw-df);
  color: var(--t-fg);
  background-color: var(--page-bg);
  overflow-x: clip;
}

h1, h2, h3, h4, h5, h6 {
  font-weight: inherit;
  font-size: inherit;
}

a {
  color: var(--t-fg);
  text-decoration: none;
}

p a {
  color: var(--t-fg);
  text-decoration: underline;
  text-decoration-color: var(--accent-secondary);
  text-decoration-thickness: 3px;
  text-underline-offset: 3px;
  transition: all 0.1s ease;
  font-weight: 500;

  &:hover {
    background-color: var(--accent-secondary);
    text-decoration-color: var(--border-color);
  }
}

p {
  line-height: 1.6;
}

p {
  margin-bottom: var(--gap);
}

[data-fadein] {
  transition: all 1s;
}

.hidden {
  opacity: 0;
}

/* Neo-brutalism utility classes */
.brutal-border {
  border: var(--border-width) solid var(--border-color);
}

.brutal-shadow {
  box-shadow: var(--shadow-brutal);
  transition: box-shadow 0.1s ease, transform 0.1s ease;

  &:hover {
    box-shadow: calc(var(--shadow-offset) + 2px) calc(var(--shadow-offset) + 2px) 0 var(--border-color);
    transform: translate(-2px, -2px);
  }
}

/* Print styles */
@media print {
  @page {
    size: A4;
    margin: 2cm 1.5cm;
  }

  body {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 11pt;
    line-height: 1.4;
    color: #000;
  }

  header.header {
    display: none !important;
  }

  a {
    text-decoration: none;
    color: #000;
  }

  .brutal-shadow {
    box-shadow: none;
  }

  .brutal-border {
    border-width: 1px;
  }

  [data-fadein] {
    opacity: 1 !important;
  }

  .theme-toggle-fixed {
    display: none !important;
  }
}

/* Fixed theme toggle */
.theme-toggle-fixed {
  position: fixed;
  bottom: var(--gap);
  right: var(--gap);
  z-index: 1000;
}

</style>
