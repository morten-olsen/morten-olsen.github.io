---
import { icons } from '~/assets/images/images.icons';
import Header from './Header.astro';
import '@fontsource/space-grotesk/400.css';
import '@fontsource/space-grotesk/500.css';
import '@fontsource/space-grotesk/700.css';

type Props = {
  title: string;
  description: string
  jsonLd?: unknown;
  image?: string;
  themeColor?: string;
}

const { title, description, jsonLd, themeColor, image }= Astro.props;
const schema = JSON.stringify(jsonLd)
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    <meta name='HandheldFriendly' content='True' />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
    <link rel='sitemap' href='/sitemap-index.xml' />
    <link rel='manifest' href='/manifest.webmanifest' />
    <script is:inline defer src="https://umami.olsen.cloud/script.js" data-website-id="3284fd7a-6452-4048-8c8c-19740171b793" />
    {themeColor && <meta name='theme-color' content={themeColor} />}
    <link
      rel='alternate'
      type='application/rss+xml'
      title='RSS Feed'
      href='/articles/rss.xml'
    />
    <meta name='description' content={description} />
    {image && <meta property='og:image' content={image} />}
    {
      jsonLd && (
        <script type='application/ld+json' is:inline set:html={schema} />
      )
    }
    {
      icons.pngs.map((icon) => (
        <link rel='icon' href={icon.src} type='image/png' sizes={icon.size} />
      ))
    }
    <title>{title}</title>
	</head>
	<body>
    <Header />
		<slot />
	</body>
</html>

<script is:inline>
const withFadeIn = document.querySelectorAll('[data-fadein]');

withFadeIn.forEach((node) => {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        node.classList.remove('hidden');
        node.setAttribute('data-shown', 'true')
      } else if (!node.hasAttribute('data-shown')) {
        node.classList.add('hidden');
      }
    })
  })

  observer.observe(node);
})
</script>

<style is:global>

@view-transition {
    navigation: auto; /* enabled! */
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  text-indent: 0;
  list-style-type: none;
}
html,
body {
  width: 100%;
  height: 100%;
}

:root {
  /* Theme colors - bold neo-brutalist palette */
  --accent-primary: #ffee00;
  --accent-secondary: #ff5757;
  --accent-tertiary: #00d4ff;
  --accent-lime: #c8ff00;
  --accent-lavender: #e4c1f9;

  /* Neo-brutalism core */
  --border-width: 4px;
  --border-color: #000;
  --shadow-offset: 6px;
  --shadow-brutal: var(--shadow-offset) var(--shadow-offset) 0 var(--border-color);
  --shadow-brutal-lg: 8px 8px 0 var(--border-color);

  /* Remove all border-radius */
  --radius: 0;
  --radius-sm: 0;

  /* Page background - off-white with subtle pattern feel */
  --page-bg: #f0f0e8;
  --card-bg: #fff;

  /* Legacy variables */
  --c-bg-em: #e8e8e0;
  --c-line: #000;
  --content-width: 1100px;
  --gap: 16px;
  --system-ui: 'Space Grotesk', system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  --t-fg: #000;
  --bg: #fff;
  --fw-df: 400;
  --fw-md: 700;
  --fs-sm: 14px;
  --fs-md: 16px;

  /* Typography */
  --font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
    Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
  --font-family-heading: 'Space Grotesk', var(--font-family);
  --font-size: 16px;
  --letter-spacing: 0.5px;
  --color: #000;
  --background-color: var(--page-bg);

  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 2rem;
  --space-xl: 3rem;
  --space-xxl: 4rem;

  --font-xxl: 2.5rem;
  --font-xl: 1.75rem;
  --font-lg: 1.25rem;
  --font-sm: 0.875rem;
  --font-xs: 0.75rem;

  --color-text-light: #333;
  --color-border: #000;
  --color-link: #000;
}

html {
  background-color: var(--page-bg);
}

body {
  font-family: var(--system-ui);
  font-size: var(--fs-md);
  font-weight: var(--fw-df);
  color: var(--t-fg);
  background-color: var(--page-bg);
}

h1, h2, h3, h4, h5, h6 {
  font-weight: inherit;
  font-size: inherit;
}

a {
  color: var(--t-fg);
  text-decoration: none;
}

p a {
  color: var(--t-fg);
  text-decoration: underline;
  text-decoration-color: var(--accent-secondary);
  text-decoration-thickness: 3px;
  text-underline-offset: 3px;
  transition: all 0.1s ease;
  font-weight: 500;

  &:hover {
    background-color: var(--accent-secondary);
    text-decoration-color: var(--border-color);
  }
}

p {
  line-height: 1.6;
}

p {
  margin-bottom: var(--gap);
}

[data-fadein] {
  transition: all 1s;
}

.hidden {
  opacity: 0;
}

/* Neo-brutalism utility classes */
.brutal-border {
  border: var(--border-width) solid var(--border-color);
}

.brutal-shadow {
  box-shadow: var(--shadow-brutal);
  transition: box-shadow 0.1s ease, transform 0.1s ease;

  &:hover {
    box-shadow: calc(var(--shadow-offset) + 2px) calc(var(--shadow-offset) + 2px) 0 var(--border-color);
    transform: translate(-2px, -2px);
  }
}

/* Print styles */
@media print {
  @page {
    size: A4;
    margin: 2cm 1.5cm;
  }

  body {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 11pt;
    line-height: 1.4;
    color: #000;
  }

  header.header {
    display: none !important;
  }

  a {
    text-decoration: none;
    color: #000;
  }

  .brutal-shadow {
    box-shadow: none;
  }

  .brutal-border {
    border-width: 1px;
  }

  [data-fadein] {
    opacity: 1 !important;
  }
}

</style>
