---
import Html from '~/components/page/Html.astro';
import type { GetStaticPaths } from "astro";
import { render } from "astro:content";
import {Â data } from '~/data/data'
import { Picture } from 'astro:assets';

export const getStaticPaths = (async () => {
  const posts = await data.posts.getPublished();
  return posts.map((post) => ({
    params: { id: post.id }
  }));
}) satisfies GetStaticPaths;

const post = await data.posts.get(Astro.params.id);
const { Content } = await render(post);
---

<Html
  title={post.data.title}
  description={post.data.description}
  jsonLd={post.jsonLd}
  image={`/posts/${post.id}/share.png`}
>
  <article>
    <div class="hero-image">
      <Picture
        loading='eager'
        class='img'
        fetchpriority="high"
        src={post.data.heroImage}
        widths={[320, 640, 1024, 1400]}
        formats={['avif', 'webp', 'png']}
        alt='Cover image'
      />
    </div>
    <div class="article-container">
      <header>
        <h1>
          {post.data.title.split(' ').map((word) => <span>{word}</span>)}
        </h1>
        <a href='/' class="author">By {data.profile.name}</a>
      </header>
      <div class='content'>
        <Content />
      </div>
    </div>
  </article>
</Html>

<style>
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-family-heading);
    font-weight: 700;
    line-height: 1.2;
    margin: 0;
  }

  article {
    font-family: var(--font-family);
    color: var(--color);
    background-color: var(--card-bg);
    font-size: 1.05rem;
    line-height: 1.7;
  }

  /* Hero image - full width banner */
  .hero-image {
    width: 100%;
    height: 50vh;
    min-height: 400px;
    overflow: hidden;
    border-bottom: var(--border-width) solid var(--border-color);

    img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }
  }

  .article-container {
    max-width: 750px;
    margin: 0 auto;
    padding: 0 var(--space-xl);
  }

  header {
    padding: calc(var(--gap) * 3) 0;
    border-bottom: var(--border-width) solid var(--border-color);
    margin-bottom: calc(var(--gap) * 2);
  }

  h1 {
    display: flex;
    flex-wrap: wrap;
    font-size: 3rem;
    line-height: 1;
    color: #000;
    text-transform: uppercase;
    font-weight: 700;
    gap: 0.4rem;
    margin-bottom: var(--gap);

    span {
      display: inline-block;
      background: var(--accent-primary);
      padding: 0.4rem 0.8rem;
      border: var(--border-width) solid var(--border-color);
      box-shadow: var(--shadow-brutal);

      &:nth-child(3n+2) {
        background: var(--accent-tertiary);
      }

      &:nth-child(3n) {
        background: var(--accent-lime);
      }
    }
  }

  .author {
    font-size: 1rem;
    font-weight: 500;
    text-transform: uppercase;
    padding: 0.5rem 1rem;
    background: var(--c-bg-em);
    border: 2px solid var(--border-color);
    display: inline-block;
  }

  .content {
    padding-bottom: calc(var(--space-xl) * 3);

    img {
      max-width: 100%;
      height: auto;
      margin-bottom: var(--space-lg);
      border: var(--border-width) solid var(--border-color);
      box-shadow: var(--shadow-brutal);
    }

    p {
      margin-bottom: var(--space-lg);
      line-height: 1.8;
    }

    p:first-of-type {
      &:first-letter {
        font-size: 4.5rem;
        border: var(--border-width) solid #000;
        background: var(--accent-primary);
        float: left;
        padding: 0.2rem var(--space-md);
        margin-right: 1rem;
        margin-bottom: 0.5rem;
        line-height: 1;
        box-shadow: var(--shadow-brutal);
      }
    }

    h2 {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: var(--space-md);
      margin-top: var(--space-xl);
      text-transform: uppercase;
      background: var(--accent-secondary);
      padding: 0.5rem 1rem;
      border: var(--border-width) solid var(--border-color);
      box-shadow: var(--shadow-brutal);
      display: inline-block;
    }

    h3 {
      font-size: 1.1rem;
      text-transform: uppercase;
      font-weight: 700;
      margin-bottom: 1rem;
      margin-top: var(--space-lg);
      padding-left: var(--space-md);
      border-left: var(--border-width) solid var(--border-color);
    }

    strong {
      background: var(--accent-primary);
      padding: 0 4px;
      border: 2px solid var(--border-color);
      font-weight: 700;
    }

    em {
      font-style: italic;
    }

    ul, ol {
      margin-bottom: var(--space-lg);
      padding-left: var(--space-lg);
    }

    li {
      list-style-type: square;
      margin-left: 1rem;
      padding-bottom: var(--space-sm);
      line-height: 1.6;

      &::marker {
        color: var(--accent-secondary);
        font-size: 1.2em;
      }
    }

    pre {
      max-width: 100%;
      overflow-x: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      padding: var(--space-lg);
      border: var(--border-width) solid var(--border-color);
      box-shadow: var(--shadow-brutal-lg);
      background: #1a1a1a;
      color: #f0f0f0;
      margin-bottom: var(--space-lg);
    }

    code:not(pre code) {
      background: var(--c-bg-em);
      padding: 2px 6px;
      border: 2px solid var(--border-color);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9em;
    }

    blockquote {
      margin: var(--space-xl) 0;
      background: var(--accent-lavender);
      padding: var(--space-lg);
      border: var(--border-width) solid var(--border-color);
      box-shadow: var(--shadow-brutal-lg);
      font-style: italic;
      font-size: 1.1rem;
      position: relative;

      &::before {
        content: '"';
        font-size: 4rem;
        font-weight: 700;
        position: absolute;
        top: -0.5rem;
        left: 0.5rem;
        opacity: 0.3;
        line-height: 1;
      }

      p:last-child {
        margin-bottom: 0;
      }
    }

    a {
      color: var(--t-fg);
      text-decoration: underline;
      text-decoration-thickness: 3px;
      text-decoration-color: var(--accent-secondary);
      text-underline-offset: 3px;
      transition: all 0.1s ease;

      &:hover {
        background: var(--accent-secondary);
      }
    }
  }

  @media (max-width: 768px) {
    .hero-image {
      height: 35vh;
      min-height: 250px;
    }

    .article-container {
      padding: 0 var(--space-lg);
    }

    header {
      padding: calc(var(--gap) * 2) 0;
    }

    h1 {
      font-size: 2rem;
    }

    .content p:first-of-type:first-letter {
      font-size: 3.5rem;
    }
  }

  /* Print styles */
  @media print {
    .hero-image {
      display: none;
    }

    .article-container {
      max-width: none;
      padding: 0;
    }

    header {
      border-bottom: 2px solid #000;
      padding: 0 0 1rem;
      margin-bottom: 1.5rem;
    }

    h1 {
      font-size: 1.8rem;

      span {
        background: none;
        border: none;
        box-shadow: none;
        padding: 0;
      }
    }

    .author {
      background: none;
      border: none;
      padding: 0;
    }

    .content {
      padding-bottom: 0;

      h2 {
        background: none;
        border: none;
        box-shadow: none;
        padding: 0;
        border-bottom: 2px solid #000;
        display: block;
      }

      pre {
        border: 1px solid #ccc;
        box-shadow: none;
        background: #f5f5f5;
        color: #000;
      }

      blockquote {
        box-shadow: none;
        background: #f5f5f5;
        border: none;
        border-left: 4px solid #000;
      }

      img {
        box-shadow: none;
      }

      strong {
        background: none;
        border: none;
      }

      p:first-of-type:first-letter {
        background: none;
        box-shadow: none;
        border: none;
      }
    }
  }
</style>
